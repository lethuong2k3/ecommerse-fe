import{r as f,j as t,I as H,Q as me,h as U,d as xe,B as ge,al as V,am as be,an as ne,t as ve,S as ye,l as _e,A as je,m as $e,k as De,w as Se,x as Ie,y as A,ao as Ne,ap as Ce,H as we,M as Ee,e as Pe,o as Te,p as Oe}from"./index-8iJ7KZwU.js";import{P as ke}from"./PaymentMethods-GjiDYbo6.js";import{L as Le}from"./Loading-B2VDB9MH.js";import{S as Ae}from"./Steps-DpZDK3oI.js";import{s as Me}from"./orderService-CE8VeX2F.js";const Re="_container_3kx1d_1",Fe="_info_3kx1d_1",He="_containerCheckOut_3kx1d_15",qe="_titleStep_3kx1d_22",Ge="_first_3kx1d_30",Be="_inputGroup_3kx1d_33",Ue="_last_3kx1d_51",Ve="_shopTable_3kx1d_56",ze="_productInfo_3kx1d_67",Qe="_productPriceQty_3kx1d_77",We="_variation_3kx1d_83",Ke="_productRemove_3kx1d_87",Xe="_footShopTable_3kx1d_91",Je="_cartSubtotal_3kx1d_97",Ye="_orderTotal_3kx1d_106",Ze="_paymentMethods_3kx1d_114",et="_boxPaymentMethods_3kx1d_119",tt="_paymentDes_3kx1d_134",nt="_paymentDesActive_3kx1d_142",rt="_disabledMethodPay_3kx1d_145",st="_products_3kx1d_148",at="_resPhoneTablet_3kx1d_172",x={container:Re,info:Fe,containerCheckOut:He,titleStep:qe,first:Ge,inputGroup:Be,last:Ue,shopTable:Ve,productInfo:ze,productPriceQty:Qe,variation:We,productRemove:Ke,footShopTable:Xe,cartSubtotal:Je,orderTotal:Ye,paymentMethods:Ze,boxPaymentMethods:et,paymentDes:tt,paymentDesActive:nt,disabledMethodPay:rt,products:st,resPhoneTablet:at};function X(e,s){return String(e)===String(s)}function Y(e,s){return Array.isArray(e)?e.map(n=>s.find(r=>X(r.value,n))).filter(n=>n):s.find(n=>X(n.value,e))||null}function Z(e){return Array.isArray(e)?e:[e]}function ot(e,s,n){if(!e)return s;if(!n)return e;if(!s)return Z(e);const r=[...Z(s)],i=r.findIndex(c=>X(c.value,e.value));return i>=0?r.splice(i,1):r.push(e),r}function it(e,s,n){if(!e&&!n)return s&&s.length&&s[0].name||"";const r=Array.isArray(e);return!e&&!r?"":r?e.map(i=>i.name).filter(Boolean).join(", "):e.name||""}function ee(e){return e?Array.isArray(e)?e.filter(Boolean).map(s=>s.value):e.value||null:null}function ct(e){const s=[];return e.forEach(n=>{if(n.group){const r=s.findIndex(i=>i.type==="group"&&i.name===n.group);r>=0?s[r].items.push(n):s.push({items:[n],type:"group",name:n.group})}else s.push(n)}),s}function dt(e,s){const n=e.length,r=s.length;if(n>r)return!1;if(s.indexOf(e)>=0)return!0;e:for(let i=0,c=0;i<n;i+=1){const o=e.charCodeAt(i);for(;c<r;)if(s.charCodeAt(c++)===o)continue e;return!1}return!0}function lt(e,s){return s.length?e.filter(n=>dt(s.toLowerCase(),`${n.name} ${n.group||""}`.trim().toLowerCase())):e}function ut(e,s,n){return e.filter(Boolean).reduce((r,i)=>i(r,n),s).map((r,i)=>({...r,index:i}))}function Q(e){let s=0;return e.map(n=>n.type==="group"?n.items.map(r=>({...r,group:n.name,index:s++})):{...n,index:s++}).flat()}function pt(e,s,n,r){const[i,c]=f.useState(()=>Q(e)),[o,l]=f.useState(!1);return f.useEffect(()=>{let h;if(s)return h=setTimeout(()=>{const p=s(r,i);l(!0),Promise.resolve(p).then(y=>c(Q(y))).finally(()=>l(!1))},n),()=>{clearTimeout(h)}},[r]),f.useEffect(()=>{c(Q(e))},[e]),[i,o]}function ht(e,s,n){const r=n.length-1;let i=null,c=-1,o=e;for(;c++<=r&&(!i||i.disabled);)o=s==="down"?o+1:o-1,o<0?o=r:o>r&&(o=0),i=n[o];return o}function ft(e,s,n){const[r,i]=f.useState(-1);return[{onKeyDown:c=>{const o=c.key.replace("Arrow","").toLowerCase();(o==="down"||o==="up")&&(c.preventDefault(),i(ht(r,o,e)))},onKeyUp:c=>{c.key==="Escape"?(c.preventDefault(),n.current.blur()):c.key==="Enter"&&(c.preventDefault(),e[r]&&s(e[r].value))}},r,i]}const W=()=>{};function mt({options:e,defaultValue:s,value:n,multiple:r,search:i,onChange:c=W,onFocus:o=W,onBlur:l=W,closeOnSelect:h=!0,placeholder:p,getOptions:y,filterOptions:m,useFuzzySearch:E=!0,debounce:C}){const $=f.useRef(),[D,S]=f.useState(null),[I,w]=f.useState(""),[a,_]=f.useState(!1),[d,P]=pt(e,y,C,I),T=b=>{const L=ot(Y(decodeURIComponent(b),d),D,r);n===void 0&&S(L),c(ee(L),L),setTimeout(()=>{$.current&&h&&$.current.blur()},0)},v=[E?lt:null,...m||[]],M=ct(ut(v,d,I)),[q,j,O]=ft(M,T,$),R={search:I,focus:a,option:D,value:ee(D),fetching:P,highlighted:j,options:M,displayValue:it(D,d,p)},G={tabIndex:"0",readOnly:!i,placeholder:p,value:a&&i?I:R.displayValue,ref:$,...q,onFocus:b=>{_(!0),o(b)},onBlur:b=>{_(!1),!D&&w(""),O(-1),l(b)},onMouseDown:b=>{a&&(b.preventDefault(),$.current.blur())},onChange:i?({target:b})=>w(b.value):null},F={tabIndex:"-1",onMouseDown(b){b.preventDefault(),T(b.currentTarget.value)}};return f.useEffect(()=>{S(Y(n===void 0?s:n,d))},[n,d]),[R,G,F]}const re=e=>typeof e=="string",te=(e,s)=>re(s)?`${s}-${e}`:s[e];function xt(e,s){return re(e)?te(e,s):Object.entries(e).filter(([n,r])=>n&&r).map(([n])=>te(n,s)).join(" ")}function gt({optionProps:e,highlighted:s,selected:n,option:r,cls:i,renderOption:c,disabled:o}){const l={...e,value:encodeURIComponent(r.value),disabled:o},h=i({option:!0,"is-selected":n,"is-highlighted":s});return t.jsxs("li",{className:i("row"),role:"menuitem","data-index":r.index,children:[c&&c(l,r,{selected:n,highlighted:s},h),!c&&t.jsx("button",{type:"button",className:h,...l,children:r.name})]})}var bt=gt;function vt(e,s){return s?Array.isArray(s)?s.findIndex(n=>n.value===e.value)>=0:s.value===e.value:!1}function se(e){const{options:s,cls:n,renderOption:r,renderGroupHeader:i,optionProps:c,snapshot:o,disabled:l}=e;return t.jsx("ul",{className:n("options"),children:s.map(h=>h.type==="group"?t.jsx("li",{role:"none",className:n("row"),children:t.jsxs("div",{className:n("group"),children:[t.jsx("div",{className:n("group-header"),children:i?i(h.name):h.name}),t.jsx(se,{...e,options:h.items})]})},h.name):t.jsx(bt,{option:h,optionProps:c,cls:n,renderOption:r,selected:vt(h,o.option),highlighted:o.highlighted===h.index,disabled:h.disabled||l},h.value))})}var yt=se;const ae=f.forwardRef(({disabled:e,placeholder:s,multiple:n,search:r,autoFocus:i,autoComplete:c="on",id:o,closeOnSelect:l=!0,className:h="select-search",renderValue:p,renderOption:y,renderGroupHeader:m,fuzzySearch:E=!0,emptyMessage:C,value:$,debounce:D=250,printOptions:S="auto",options:I=[],...w},a)=>{const _=f.useRef(null),d=b=>xt(b,h),[P,T]=f.useState($),[v,M,q]=mt({value:P,placeholder:s,multiple:n,search:r,closeOnSelect:l&&!n,useFuzzySearch:E,options:I,printOptions:S,debounce:D,...w}),{highlighted:j,value:O,fetching:R,focus:G}=v,F={...M,autoFocus:i,autoComplete:c,disabled:e};return f.useEffect(()=>{const{current:b}=_;if(b){const L=Array.isArray(O)?O[0]:O,B=b.querySelector(j>-1?`[data-index="${j}"]`:`[value="${encodeURIComponent(L)}"]`);if(B){const u=b.getBoundingClientRect(),g=B.getBoundingClientRect();b.scrollTop=B.offsetTop-u.height/2+g.height/2}}},[O,j,_.current]),f.useEffect(()=>T($),[$]),t.jsxs("div",{ref:a,id:o,className:d({container:!0,"is-multiple":n,"is-disabled":e,"is-loading":R,"has-focus":G}),children:[(!n||s||r)&&t.jsxs("div",{className:d("value"),children:[p&&p(F,v,d("input")),!p&&t.jsx("input",{...F,className:d("input")})]}),t.jsxs("div",{className:d("select"),ref:_,onMouseDown:b=>b.preventDefault(),children:[v.options.length>0&&t.jsx(yt,{options:v.options,optionProps:q,renderOption:y,renderGroupHeader:m,disabled:e,snapshot:v,cls:d}),!v.options.length&&t.jsx("ul",{className:d("options"),children:!v.options.length&&C&&t.jsx("li",{className:d("not-found"),children:C})})]})]})});ae.displayName="SelectSearch";var _t=ae,K=_t;function jt({payment:e,setPayment:s,listProductCart:n,formik:r,province:i,district:c,ward:o,getData:l,deleteItem:h,isLoadingCart:p,listMethods:y,handleProvinceChange:m,handleDistrictChange:E,handleWardChange:C,subTotal:$,fee:D,errSelect:S}){const I=(a,_,d)=>{_<d.productDetail.amount&&l(a,{quantity:+_+1})},w=(a,_)=>{_<=1||l(a,{quantity:+_-1})};return t.jsx("div",{className:x.containerCheckOut,children:t.jsxs("form",{onSubmit:r.handleSubmit,style:{display:"contents"},children:[t.jsxs("div",{className:x.first,children:[t.jsx("h3",{className:x.titleStep,children:"CHI TIẾT ĐƠN HÀNG"}),t.jsxs("div",{className:x.inputGroup,children:[t.jsx(H,{id:"firstName",label:"Họ",type:"text",isRequired:!0,formik:r,borderErr:!0,placeholder:"Họ"}),t.jsx(H,{id:"lastName",label:"Tên",type:"text",isRequired:!0,formik:r,borderErr:!0,placeholder:"Tên"})]}),t.jsx(H,{id:"streetAddress",label:"Địa chỉ",type:"text",formik:r,borderErr:!0,placeholder:"Địa chỉ",isRequired:!0}),t.jsx("label",{children:"Tỉnh / TP"}),t.jsx("div",{style:{border:S("provinceID")?"1px solid #c62828":"",margin:"5px 0px 15px 0px"},children:t.jsx(K,{options:i==null?void 0:i.map(a=>({name:a.ProvinceName,value:Number(a.ProvinceID)})),name:"provinceID",placeholder:"Tỉnh / TP",search:!0,value:r.values.provinceID,onChange:a=>m(a),onBlur:()=>r.setFieldTouched("provinceID",!0)})}),t.jsx("label",{children:"Quận / Huyện"}),t.jsx("div",{style:{border:S("districtID")?"1px solid #c62828":"",margin:"5px 0px 15px 0px"},children:t.jsx(K,{options:c==null?void 0:c.map(a=>({name:a.DistrictName,value:Number(a.DistrictID)})),name:"districtID",placeholder:"Quận / Huyện",search:!0,value:r.values.districtID,onChange:a=>E(a),onBlur:()=>r.setFieldTouched("districtID",!0)})}),t.jsx("label",{children:"Phường / Xã"}),t.jsx("div",{style:{border:S("wardID")?"1px solid #c62828":"",margin:"5px 0px 15px 0px"},children:t.jsx(K,{options:o==null?void 0:o.map(a=>({name:a.WardName,value:Number(a.WardCode)})),name:"wardID",placeholder:"Phường / Xã",search:!0,value:r.values.wardID,onChange:a=>C(a),onBlur:()=>r.setFieldTouched("wardID",!0)})}),t.jsx(H,{id:"phone",label:"Số điện thoại",type:"number",formik:r,borderErr:!0,isRequired:!0,placeholder:"Số điện thoại"}),t.jsx(H,{id:"email",label:"Email",type:"text",formik:r,borderErr:!0,isRequired:!0,placeholder:"Email"}),t.jsx("h3",{className:x.titleStep,children:"Thông tin bổ sung"}),t.jsx(H,{id:"orderComment",label:"Lời nhắn",type:"textarea",formik:r,placeholder:"Ghi chú thêm (Ví dụ: Giao hàng giờ hành chính)"})]}),t.jsxs("div",{className:x.last,children:[t.jsx("h3",{className:x.titleStep,children:"Thanh toán"}),p==!0?t.jsx(Le,{}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:x.products,children:n==null?void 0:n.map((a,_)=>t.jsxs("div",{className:x.shopTable,children:[t.jsx("img",{src:"https://xstore.8theme.com/elementor2/marseille04/wp-content/uploads/sites/2/2022/12/Image-1.1-min.jpg"}),t.jsxs("div",{className:x.productInfo,children:[t.jsx("div",{className:x.productName,children:a.productDetail.product.name}),t.jsxs("div",{className:x.productPriceQty,children:[t.jsx(me,{increment:I,decrement:w,item:a,quantity:a.quantity,productDetail:a.productDetail,productDetailCart:a}),t.jsx("span",{children:"x"}),t.jsx("span",{className:x.price,children:U(a.productDetail.price)})]}),t.jsxs("div",{className:x.variation,children:["Size:",t.jsx("span",{children:a.productDetail.size.name})]}),t.jsxs("div",{className:x.variation,children:["Màu sắc:",t.jsx("span",{children:a.productDetail.color.name})]}),t.jsx("div",{className:x.productRemove,onClick:()=>h(a.id),children:"xóa"})]})]},_))}),t.jsxs("div",{className:x.footShopTable,children:[t.jsxs("div",{className:x.cartSubtotal,children:["Tổng tiền hàng:",t.jsx("span",{children:U($)})]}),t.jsxs("div",{className:x.cartSubtotal,children:["Phí ship: ",t.jsx("span",{children:U(D)})]}),t.jsxs("div",{className:x.orderTotal,children:["Cần thanh toán:",t.jsx("span",{children:U($+D)})]})]}),t.jsxs("div",{className:x.paymentMethods,children:[y.map(a=>t.jsxs("div",{className:x.boxPaymentMethods,children:[t.jsx("input",{id:"method_"+a.value,type:"radio",name:"payment_method",value:a.id,checked:e===a.id,onChange:_=>s(a.id)}),t.jsxs("div",{className:x.boxPaymentMethod,children:[t.jsx("label",{htmlFor:"method_"+a.value,children:t.jsx("img",{src:a.imageUrl,alt:a.value})}),t.jsx("div",{className:xe(x.paymentDes,{[x.paymentDesActive]:e===a.id}),children:`${a.value}: ${a.description}`})]})]},a.id)),t.jsx(ge,{content:"PLACE ORDER",style:{width:"100%",marginTop:"10px"}}),t.jsx(ke,{})]})]})]})]})})}var oe={},ie={};(function(e){var s=V&&V.__rest||function(o,l){var h={};for(var p in o)Object.prototype.hasOwnProperty.call(o,p)&&l.indexOf(p)<0&&(h[p]=o[p]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,p=Object.getOwnPropertySymbols(o);y<p.length;y++)l.indexOf(p[y])<0&&Object.prototype.propertyIsEnumerable.call(o,p[y])&&(h[p[y]]=o[p[y]]);return h};Object.defineProperty(e,"__esModule",{value:!0}),e.scripts=void 0;var n=f;e.scripts={};var r=function(o){var l=document.querySelector('script[src="'+o+'"]');if(l)return e.scripts[o]={loading:!1,error:null,scriptEl:l}};function i(o){var l=o.src,h=o.checkForExisting,p=h===void 0?!1:h,y=s(o,["src","checkForExisting"]),m=l?e.scripts[l]:void 0;!m&&p&&l&&c&&(m=r(l));var E=(0,n.useState)(m?m.loading:!!l),C=E[0],$=E[1],D=(0,n.useState)(m?m.error:null),S=D[0],I=D[1],w=(0,n.useState)(!1),a=w[0],_=w[1];return(0,n.useEffect)(function(){if(!(!c||!l||a||S)){m=e.scripts[l],!m&&p&&(m=r(l));var d;m?d=m.scriptEl:(d=document.createElement("script"),d.src=l,Object.keys(y).forEach(function(v){d[v]===void 0?d.setAttribute(v,y[v]):d[v]=y[v]}),m=e.scripts[l]={loading:!0,error:null,scriptEl:d});var P=function(){m&&(m.loading=!1),$(!1),_(!0)},T=function(v){m&&(m.error=v),I(v)};return d.addEventListener("load",P),d.addEventListener("error",T),document.body.appendChild(d),function(){d.removeEventListener("load",P),d.removeEventListener("error",T)}}},[l]),[C,S]}e.default=i;var c=typeof window<"u"&&typeof window.document<"u"})(ie);(function(e){var s=V&&V.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0}),e.scripts=e.default=void 0;var n=ie;Object.defineProperty(e,"default",{enumerable:!0,get:function(){return s(n).default}}),Object.defineProperty(e,"scripts",{enumerable:!0,get:function(){return n.scripts}})})(oe);const $t=be(oe),J=ne.create({baseURL:"https://online-gateway.ghn.vn/shiip/public-api/master-data",timeout:1e4,headers:{"Content-Type":"application/json",token:"bf465bbb-50b6-11f0-8ee5-decd4d9f36e0"}}),Dt=ne.create({baseURL:"https://online-gateway.ghn.vn/shiip/public-api/v2/shipping-order",timeout:1e4,headers:{"Content-Type":"application/json",token:"bf465bbb-50b6-11f0-8ee5-decd4d9f36e0",shop_id:"5854359"}}),St=async()=>await J.get("/province"),It=async e=>await J.get("/district",{params:{province_id:e}}),Nt=async e=>await J.get("/ward",{params:{district_id:e}}),Ct=async e=>await Dt.post("/fee",e),wt=async e=>await ve.put(`/payos/${e}`);function Lt(){const{listProductCart:e,handleGetListProductsCart:s}=f.useContext(ye),{toast:n}=f.useContext(_e),{userInfo:r}=f.useContext(je),[i,c]=f.useState([]),[o,l]=f.useState(1),[h,p]=f.useState(!1),[y,m]=f.useState(!1),[E,C]=f.useState(!1),[$,D]=f.useState([]),[S,I]=f.useState([]),[w,a]=f.useState([]),[_,d]=f.useState(0),P=$e.get("id"),T=De(),v=e==null?void 0:e.reduce((u,g)=>u+g.totalPrice,0);$t({src:"https://cdn.payos.vn/payos-checkout/v1/stable/payos-initialize.js",checkForExisting:!0});const M=`${window.location.href}/ket-qua`,q=u=>{switch(u){case"provinceID":return j.touched.provinceID&&j.errors.provinceID;case"districtID":return j.touched.districtID&&j.errors.districtID;case"wardID":return j.touched.wardID&&j.errors.wardID}},j=Se({initialValues:{firstName:"",lastName:"",provinceID:"",districtID:"",wardID:"",streetAddress:"",phone:"",email:"",orderComment:""},validationSchema:Ie({firstName:A().required(),lastName:A().required(),streetAddress:A().required(),provinceID:A().required(),districtID:A().required(),wardID:A().required(),phone:Ne().required(),email:A().email().required()}),onSubmit:async u=>{if(y)return;const{firstName:g,lastName:N,streetAddress:k,provinceID:ce,districtID:de,wardID:le,phone:ue,email:pe,orderComment:he}=u;let fe={shipmentRequest:{firstName:g,lastName:N,address:k,idAddress:`${ce}, ${de}, ${le}`,phone:ue,email:pe,notes:he},paymentTypeId:o,shippingFee:_};m(!0),Me(fe).then(z=>{m(!1),R(z.data.data)}).catch(z=>{m(!1),console.log(z)})}}),O=u=>{wt(u).then(g=>{console.log(g.data)}).catch(g=>{console.log(g)})},R=async function(u){if(u){let g=u.checkoutUrl,{open:N}=window.PayOSCheckout.usePayOS({RETURN_URL:M,ELEMENT_ID:"config_root",CHECKOUT_URL:g,embedded:!1,onExit:async k=>{console.log(k)},onSuccess:async k=>{console.log(k)},onCancel:async k=>{console.log(k),O(k.orderCode)}});N()}},G=(u,g)=>{p(!0),Te(u,g).then(N=>{if(N.data.errors){n.error(N.data.errors[400]),p(!1);return}s(P),p(!1)}).catch(N=>{p(!1),console.log(N)})},F=u=>{p(!0),Oe(u).then(g=>{e.legth,s(P),p(!1)}).catch(g=>{p(!1),console.log(g)})},b=u=>{j.setFieldValue("provinceID",u),It(u).then(g=>{I(g.data.data),a([]),d(0)}).catch(g=>{console.log(g),a([]),d(0)})},L=u=>{j.setFieldValue("districtID",u),Nt(u).then(g=>{a(g.data.data),d(0)}).catch(g=>{console.log(g),d(0)})},B=u=>{j.setFieldValue("wardID",u);let g={service_type_id:2,insurance_value:v,from_district_id:3695,to_district_id:j.values.districtID,to_ward_code:String(u),height:15,length:15,weight:1e3,width:15};Ct(g).then(N=>{d(N.data.data.total)}).catch(N=>{d(0),console.log(N)})};return f.useEffect(()=>{if((e==null?void 0:e.length)==0||!e){T("/gio-hang");return}},[e]),f.useEffect(()=>{r&&j.setFieldValue("email",r.email),C(!0),Ce().then(u=>{c(u.data.data),C(!1)}).catch(u=>{console.log(u)}),St().then(u=>{D(u.data.data)}).catch(u=>{console.log(u)})},[]),t.jsx("div",{id:"config_root",style:{display:"flex",flexDirection:"column"},children:(e==null?void 0:e.length)==0||E||!$?t.jsx("div",{children:"...Loading"}):t.jsxs("div",{children:[t.jsx(we,{}),t.jsx(Ae,{className:x.resPhoneTablet,step:2}),t.jsx("div",{className:x.container,children:t.jsx(Ee,{children:t.jsx(jt,{payment:o,setPayment:l,listProductCart:e,formik:j,getData:G,deleteItem:F,isLoadingCart:h,listMethods:i,province:$,district:S,ward:w,handleProvinceChange:b,handleDistrictChange:L,handleWardChange:B,subTotal:v,fee:_,errSelect:q})})}),t.jsx(Pe,{})]})})}export{Lt as default};
